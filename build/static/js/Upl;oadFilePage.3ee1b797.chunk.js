(this["webpackJsonpscraping-penguins-frontend-template"]=this["webpackJsonpscraping-penguins-frontend-template"]||[]).push([[13],{609:function(e,t,n){"use strict";n.r(t);var c=n(25),o=n(50),a=n(5),r=n(0),s=n(237),i=n(585),l=n(234),d=n(48),u=n(1),p=n(588),x=n(7);function j(e){var t=e.onFileUpload,n=Object(r.useCallback)((function(e){if(1===e.length){var n=e[0];"text/csv"===n.type||"application/vnd.ms-excel"===n.type?t(n):alert("Please upload a CSV file.")}else alert("Please upload only one file.")}),[t]),c=Object(p.a)({onDrop:n}),o=c.getRootProps,a=c.getInputProps;return Object(x.jsxs)("div",Object(u.a)(Object(u.a)({},o()),{},{style:f,children:[Object(x.jsx)("input",Object(u.a)({},a())),Object(x.jsx)("p",{children:"Drag 'n' drop a CSV file here, or click to select one"})]}))}var f={border:"2px dashed #ccc",borderRadius:"4px",padding:"20px",width:"100%",height:"300px",textAlign:"center",cursor:"pointer"},b=n(236),m=n(584),h=n(601),v=function(e){var t=e.documents,n=function(e){var t=new Date(e);return{date:t.toLocaleDateString(),time:t.toLocaleTimeString()}},a=function(e){var t=Math.floor(e/1e3%60),n=Math.floor(e/6e4%60),c=Math.floor(e/36e5),o=[];return c>0&&o.push("".concat(c," hour").concat(c>1?"s":"")),n>0&&o.push("".concat(n," minute").concat(n>1?"s":"")),(t>0||0===c&&0===n)&&o.push("".concat(t," second").concat(t>1?"s":"")),o.join(" ")},r=function(){var e=Object(o.a)(Object(c.a)().mark((function e(t){var n;return Object(c.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fetch("".concat(d.b,"cancelprocessing/").concat(t._id),{method:"GET"});case 3:if(!(n=e.sent).ok){e.next=10;break}return e.next=7,n.json();case 7:e.sent,e.next=11;break;case 10:console.error("Error cancelling processing:",n.statusText);case 11:e.next=16;break;case 13:e.prev=13,e.t0=e.catch(0),console.error("Error:",e.t0.message);case 16:case"end":return e.stop()}}),e,null,[[0,13]])})));return function(t){return e.apply(this,arguments)}}(),s=[{title:"Index",dataIndex:"index",key:"index"},{title:"Uploaded Date",dataIndex:"uploadeddate",key:"uploadeddate",render:function(e){var t=n(e),c=t.date,o=t.time;return Object(x.jsx)("span",{children:"".concat(c," ").concat(o)})}},{title:"Completed Date",dataIndex:"completeddate",key:"completeddate",render:function(e,t){var c=n(e),o=c.date,a=c.time;return Object(x.jsx)("span",{children:"processing"===t.status?"":"".concat(o," ").concat(a)})}},{title:"Status",dataIndex:"status",key:"status",render:function(e){return Object(x.jsx)("span",{children:e})}},{title:"Processing time",dataIndex:"processingTime",key:"processingTime",render:function(e){return Object(x.jsx)("span",{children:a(e)})}},{title:"Proxy request count",dataIndex:"requestCount",key:"requestCount"},{title:"Total rows",dataIndex:"totalRows",key:"totalRows"},{title:"Download",dataIndex:"status",key:"status",render:function(e,t){return Object(x.jsx)(x.Fragment,{children:"completed"===e?Object(x.jsx)(l.a,{type:"primary",onClick:function(){!function(e){if(e){var t=new Blob([e.fileContent],{type:"text/csv"}),n=window.URL.createObjectURL(t),c=document.createElement("a");c.href=n,c.download="output-data.csv",document.body.appendChild(c),c.click(),document.body.removeChild(c)}}(t)},children:"Download File"}):"cancelled"===e?Object(x.jsx)("span",{children:"Cancelled"}):Object(x.jsx)("div",{style:{display:"flex",flexDirection:"column",justifyContent:"center"},children:t.rowsProcessed?Object(x.jsxs)(x.Fragment,{children:[Object(x.jsx)(m.a,{percent:t.processedPErcentage?t.processedPErcentage:0,size:"small"}),"Processing ",t.rowsProcessed,"/",t.totalRows,Object(x.jsx)(l.a,{type:"primary",style:{marginTop:"10px"},onClick:function(){r(t)},children:"Cancel"})]}):Object(x.jsx)(b.a,{size:"small"})})})}}];if(null===t||void 0===t||!t.length)return Object(x.jsx)("span",{children:"No previous data to show!"});var i=t.map((function(e,t){return{_id:e._id,index:t.toString(),uploadeddate:e.createdAt,completeddate:e.completedAt,status:e.status,fileContent:e.fileContent,processedPErcentage:e.processedPErcentage,rowsProcessed:e.rowsProcessed,totalRows:e.totalRows,processingTime:e.processingTime,requestCount:e.requestCount}}));return Object(x.jsx)(h.a,{rowKey:function(e){return e.index},dataSource:i,columns:s})},O=s.a.Content,g={content:{padding:"0px 16px 16px 16px",margin:"50px auto",width:"100%",minHeight:"600px",maxWidth:"1200px",alignItems:"center",display:"flex",flexDirection:"column"}};t.default=function(){var e=Object(r.useState)(null),t=Object(a.a)(e,2),n=t[0],u=t[1],p=Object(r.useState)(!1),f=Object(a.a)(p,2),h=f[0],w=f[1],y=Object(r.useState)(null),k=Object(a.a)(y,2),C=k[0],P=k[1],R=Object(r.useState)([]),E=Object(a.a)(R,2),T=E[0],S=E[1],I=Object(r.useState)({}),D=Object(a.a)(I,2),F=D[0],U=D[1],L=Object(r.useState)(0),q=Object(a.a)(L,2),B=q[0],_=q[1];Object(r.useEffect)((function(){var e;return C&&(e=setInterval(Object(o.a)(Object(c.a)().mark((function t(){var n,o,a,r;return Object(c.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,fetch("".concat(d.b,"documentstatus/").concat(C),{method:"GET"});case 2:if(!(n=t.sent).ok){t.next=8;break}return t.next=6,n.json();case 6:"completed"===(o=t.sent).status?(u(o.fileContent),P(null),w(!1),clearInterval(e)):(a={totalRows:null!==o&&void 0!==o&&o.totalRows?null===o||void 0===o?void 0:o.totalRows:0,rowsProcessed:null!==o&&void 0!==o&&o.rowsProcessed?null===o||void 0===o?void 0:o.rowsProcessed:0,status:null!==o&&void 0!==o&&o.status?null===o||void 0===o?void 0:o.status:"processing"},r=((null===o||void 0===o?void 0:o.rowsProcessed)/(null===o||void 0===o?void 0:o.totalRows)*100).toFixed(2),_(r),U(a));case 8:case"end":return t.stop()}}),t)}))),1e3)),z(),function(){return clearInterval(e)}}),[C]);var z=function(){var e=Object(o.a)(Object(c.a)().mark((function e(){var t,n,o;return Object(c.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("".concat(d.b,"documents/"),{method:"GET"});case 2:if(!(t=e.sent).ok){e.next=12;break}return e.next=6,t.json();case 6:n=e.sent,(o=n.data).forEach((function(e){e.processedPErcentage=(e.rowsProcessed/e.totalRows*100).toFixed(2)})),S(o),n.data.some((function(e){return"processing"===e.status}))&&setTimeout(z,1e3);case 12:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();Object(r.useEffect)((function(){z()}),[]);var A=function(){var e=Object(o.a)(Object(c.a)().mark((function e(t){var n,o,a;return Object(c.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return w(!0),e.prev=1,(n=new FormData).append("file",t),e.next=6,fetch("".concat(d.b,"uploadFile"),{method:"POST",body:n});case 6:if(!(o=e.sent).ok){e.next=15;break}return e.next=10,o.json();case 10:a=e.sent,P(null===a||void 0===a?void 0:a.result._id),u(a.fileContent),e.next=16;break;case 15:console.error("Error uploading file:",o.statusText);case 16:e.next=21;break;case 18:e.prev=18,e.t0=e.catch(1),console.error("Error:",e.t0.message);case 21:case"end":return e.stop()}}),e,null,[[1,18]])})));return function(t){return e.apply(this,arguments)}}();return console.log("Processing info",F),Object(x.jsx)(s.a,{className:"site-layout",children:Object(x.jsxs)(O,{className:"site-layout-background",style:g.content,children:[Object(x.jsx)(i.a,{title:"Upload CSV file",onBack:function(){w(!1),u(null)},ghost:!1,style:{alignSelf:"flex-start",padding:"20px 0px"}}),"cancelled"!==F.status&&h&&Object(x.jsxs)("div",{style:{display:"flex",flexDirection:"column",justifyContent:"center"},children:[Object(x.jsx)(b.a,{size:"large"}),F.totalRows>0&&Object(x.jsxs)(x.Fragment,{children:[Object(x.jsx)("div",{style:{marginTop:"46px",marginBottom:"50px"},children:"Processing ".concat(F.rowsProcessed,"/").concat(F.totalRows," rows. Please wait...")}),Object(x.jsx)(m.a,{type:"circle",percent:B,style:{marginTop:"16px",marginBottom:"50px",marginLeft:"55px"}})]})]}),n&&!h?Object(x.jsx)(l.a,{type:"primary",onClick:function(){return function(e){if(e){var t=new Blob([e],{type:"text/csv"}),n=window.URL.createObjectURL(t),c=document.createElement("a");c.href=n,c.download="output-data.csv",document.body.appendChild(c),c.click(),document.body.removeChild(c)}}(n)},children:"Download File"}):Object(x.jsx)(x.Fragment,{children:!h&&Object(x.jsx)(j,{onFileUpload:A})}),T.length>0&&Object(x.jsx)("div",{style:{display:"flex",marginTop:"30px"},children:Object(x.jsx)(v,{documents:T})})]})})}}}]);
//# sourceMappingURL=Upl;oadFilePage.3ee1b797.chunk.js.map